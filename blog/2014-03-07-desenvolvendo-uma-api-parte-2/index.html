<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="1">

        <meta property="og:title" content="Desenvolvendo uma API - Parte 2 | Tony Messias"/>
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://tonysm.github.io/blog/2014-03-07-desenvolvendo-uma-api-parte-2"/>
        <meta property="og:description" content="Personal blog. Web development, Linux, and Programming in general." />

        <title>Tony Messias | Desenvolvendo uma API - Parte 2</title>

        <link rel="home" href="https://tonysm.github.io">
        <link rel="icon" href="/favicon.ico">
        <link href="/blog/feed.atom" type="application/atom+xml" rel="alternate" title="Tony Messias Atom Feed">

            <meta property="og:title" content="Desenvolvendo uma API - Parte 2" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://tonysm.github.io/blog/2014-03-07-desenvolvendo-uma-api-parte-2"/>
    <meta property="og:description" content="" />

                    <!-- Insert analytics code here -->
        
        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i" rel="stylesheet">
        <link rel="stylesheet" href="/assets/build/css/main.css?id=2d84e82231bd173991f0">
    </head>

    <body class="flex flex-col justify-between min-h-screen bg-grey-lightest text-grey-darkest leading-normal font-sans">
        <header class="flex items-center shadow bg-white border-b h-24 py-4" role="banner">
            <div class="container flex items-center max-w-4xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="/" title="Tony Messias home" class="inline-flex items-center">
                        <h1 class="text-lg md:text-2xl text-blue-darkest font-semibold hover:text-blue-dark my-0">Tony Messias</h1>
                    </a>
                </div>

                <div id="vue-search" class="flex flex-1 justify-end items-center">
                    <search></search>

                    <nav class="hidden lg:flex items-center justify-end text-lg">
    <a title="Tony Messias Articles" href="/blog"
        class="ml-6 text-grey-darker hover:text-blue-dark ">
        Articles
    </a>

    <a title="Tony Messias About" href="/about"
        class="ml-6 text-grey-darker hover:text-blue-dark ">
        About
    </a>

</nav>

                    <button class="flex justify-center items-center bg-blue border border-blue h-10 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

                </div>
            </div>
        </header>

        <nav id="js-nav-menu" class="nav-menu hidden lg:hidden">
    <ul class="list-reset my-0">
        <li class="pl-4">
            <a
                title="Tony Messias Articles"
                href="/blog"
                class="nav-menu__item hover:text-blue "
            >Articles</a>
        </li>
        <li class="pl-4">
            <a
                title="Tony Messias About"
                href="/about"
                class="nav-menu__item hover:text-blue "
            >About</a>
        </li>
    </ul>
</nav>

        <main role="main" class="flex-auto w-full container max-w-xl mx-auto py-16 px-6">
                        <img src="/assets/images/posts/api-cloud-tumb.png" alt="Desenvolvendo uma API - Parte 2 cover image" class="mb-2">
    
    <h1 class="leading-none mb-2">Desenvolvendo uma API - Parte 2</h1>

    <p class="text-grey-darker text-xl md:mt-0">Tony Messias  •  March 6, 2014</p>

                        <a
                href="/blog/categories/PHP"
                title="View posts in PHP"
                class="inline-block bg-grey-light hover:bg-blue-lighter leading-loose tracking-wide text-grey-darkest uppercase text-xs font-semibold rounded mr-4 px-3 pt-px"
            >PHP</a>
                    <a
                href="/blog/categories/API"
                title="View posts in API"
                class="inline-block bg-grey-light hover:bg-blue-lighter leading-loose tracking-wide text-grey-darkest uppercase text-xs font-semibold rounded mr-4 px-3 pt-px"
            >API</a>
                    <a
                href="/blog/categories/development"
                title="View posts in development"
                class="inline-block bg-grey-light hover:bg-blue-lighter leading-loose tracking-wide text-grey-darkest uppercase text-xs font-semibold rounded mr-4 px-3 pt-px"
            >development</a>
                    <a
                href="/blog/categories/REST"
                title="View posts in REST"
                class="inline-block bg-grey-light hover:bg-blue-lighter leading-loose tracking-wide text-grey-darkest uppercase text-xs font-semibold rounded mr-4 px-3 pt-px"
            >REST</a>
            
    <div class="border-b border-blue-lighter mb-10 pb-4" v-pre>
        <p>Atualmente o modelo de API's mais utilizado é o REST. Não conhece? Explicarei um pouco aqui do funcionamento desse modelo. A teoria é bem simples, na verdade, mas muitas vezes subestimada.</p>
<p>Para começo de conversa, vou linkar aqui um video que abriu a minha cabeça para o que é REST de verdade. O video se chama &quot;Teach a dog to REST&quot; e é incrível! Esse video caiu como uma luva para mim, pois eu tinha acabado de fazer uma API num antigo trabalho e não tinha o menor conhecimento sobre REST, acabei cometendo vários erros como as URLs mostradas no vídeo. Sem mais delongas, assistam ao <a href="https://vimeo.com/17785736">video</a>.</p>
<p>Construir uma API é um processo que parece simples no começo, mas, acreditem, é complexo pra caramba! REST é o conceito básico das API hoje em dia, existem outros modelos como o SOAP, mas não vou entrar em detalhes, até porque nunca os usei na prática.</p>
<p>Uma boa API é um problema de design, como é falado no vídeo. A API que citei acredito que ainda está em uso hoje em dia e alguns erros foram cometidos no processo de desenvolvimento. Não por ser um time ruim, mas porque eramos todos novos no ramo e não conheciamos as melhores práticas e todo o universo por trás das APIs.</p>
<p>Fizemos URL's feias, como essas:</p>
<pre>
/getAllUsersWithTasks
/getAllFinishedTasks
/getAllPendingTasksWithUser/{user\_id}
</pre>
<p>Qual o recurso negóciado nessas URL's? Não dá pra saber só de olhar a URL, temos que tentar ler a mesma e compreender o que pode vir dela. Ah, e basicamente só utilizavamos dois métodos HTTP para os requests GET e POST.</p>
<h2>O que é necessário</h2>
<p>Vou listar aqui o que eu acredito ser necessário para uma boa API REST.</p>
<ul>
<li>Utilizar muito bem os vérbos HTTP</li>
<li>Utilizar apenas recursos nas URLs</li>
<li>Toda complexidade deve ser tratada fora da URL (depois do ?)</li>
<li>Linkar muito bem os recursos (Relacionamentos)</li>
<li>Pense sempre RESTful</li>
</ul>
<h2>Utilizando 110% do HTTP</h2>
<p>Todos os <em>clients</em> que irão utilizar nossas API's REST a farão (até onde sei) via HTTP. HTTP é um protocolo de comunicação que é a base da nossa WEB. Para melhor entendermos REST, precisamos entender o HTTP. Existem cerca de 9 métodos HTTP, conforme a <a href="http://pt.wikipedia.org/wiki/Hypertext_Transfer_Protocol#M.C3.A9todos">Wikipédia</a>, mas falaremos basicamente de 6, são eles: GET, POST, PATCH, PUT, DELETE e OPTIONS.</p>
<p>Abaixo, vamos entender melhor o que são cada um desses métodos:</p>
<ul>
<li>GET - solicitar recursos;</li>
<li>POST - criar recursos;</li>
<li>PUT - atualizar um recurso por completo;</li>
<li>PATCH - atualizar parte de um recurso;</li>
<li>DELETE - excluir um recurso;</li>
<li>OPTIONS - utilizado por apps front-end para saber quais métodos estão disponíveis na nossa API (ver <a href="http://pt.wikipedia.org/wiki/Cross-origin_resource_sharing">CORs</a>);</li>
</ul>
<p>Falaremos mais sobre o CORs depois.</p>
<h2>Exemplos</h2>
<p>Um exemplo de request para a nossa API usando GET:</p>
<pre>
GET /dogs HTTP1.1
Host: www.example.com
</pre>
<p>Esse exemplo acima poderia ser utilizado caso o usuário precisasse listar todos os cachorros, por exemplo. Não estamos considerando paginação ainda.</p>
<p>Para criar um novo cachorro na API, utilizaria o método POST:</p>
<pre>
POST /dogs HTTP 1.1
Host: www.example.com
Payload: {"name": "Luke", "race": "unknown"}
</pre>
<p>Você pode ver que a URL é a mesma, porém o método HTTP agora é POST e enviamos para o servidor os dados do novo cachorro via payload.</p>
<p>Agora, digamos que queremos atualizar o nome do cachorro acima e que o mesmo é representado pelo ID 1, temos então um PATCH:</p>
<pre>
PATCH /dogs/1 HTTP 1.1
Host: www.example.com
Payload: {"name": "Luke teste"}
</pre>
<p>Pronto. Com isso, atualizamos o nome do nosso cachorro. Um detalhe aqui é que utilizamos o método PATCH e não PUT. Por que? Porque o PUT é utilizado quando queremos atualizar todos os atributos de um recurso. É um <em>replace</em>, praticamente.</p>
<p>Para deletar o cachorro cadastrado, utilizamos o método DELETE:</p>
<pre>
DELETE /dogs/1 HTTP 1.1
Host: www.example.com
</pre>
<p>Pronto. Nosso cachorro foi excluído.</p>
<p>Vejam que não entramos em detalhes sobre o payload ou sobre as respostas, isso será tratado mais para frente, em outro post.</p>
<h2>Complexidades</h2>
<p>Mas, claro, nem tudo são flores. Digamos que eu queira listar apenas os cachorros sem raça, como eu faria? Seguindo o padrão (errado) apresentado no começo do artigo, seria algo mais ou menos assim:</p>
<pre>
GET /dogsWithUnknownRace HTTP 1.1
Host: www.example.com
</pre>
<p>Certo. Já vimos que isso é errado, então, não façam assim. Mas de que outra forma podemos passar complexidades para nossas URL's? Resposta: Não passe. Mantenha a complexidade fora da URL. Como? Assim:</p>
<pre>
GET /dogs?race=unknown HTTP 1.1
Host: www.example.com
</pre>
<p>Dessa forma, sabemos exatamente que estamos listando cachorros apenas com raça desconhecida. Assim, mantemos a complexidade fora da URL, e essa fica apenas com o nosso recurso principal. Vamos para mais um exemplo: Digamos que você agora quer listar todos os cachorros de raça desconhecida da cor preta.</p>
<pre>
GET /dogs?race=unknown&amp;color=black HTTP 1.1
Host: www.example.com
</pre>
<p>Bom, espero que tenham entendido onde quero chegar.</p>
<h2>Relacionamentos</h2>
<p>Digamos que os usuários da nossa API são os donos dos cachorros. Para saber qual o dono do cachorro de ID 1, por exemplo, temos o seguinte request:</p>
<pre>
GET /dogs/1/owners HTTP 1.1
Host: www.example.com
</pre>
<p>Agora, digamos que o dono do cachorro de ID 1, tenha outros 2 cachorros e seu ID na API é 42, para saber quais os cachorros que esse usuário tem, podemos fazer assim:</p>
<pre>
GET /owners/42/dogs HTTP 1.1
Host: www.example.com
</pre>
<p>Como exemplificado acima, podemos ter mais de uma forma para acessar um recurso. Fica a cargo do time escolher quais os recursos principais e mais coesos e onde e quando utilizar os recursos de relacionamento.</p>
<p>Um ponto importante sobre relacionamentos é que o ultimo recurso da URL deve ser o foco da requisição. Ou seja, na url <em>/dogs/42/owners</em> estamos falando dos <em>owners</em> e não dos cachorros. O cachorro só está ai por conta do relacionamento.</p>
<h2>Concluindo...</h2>
<p>Bom, é isso. Isso é o básico do REST. Não entrei em detalhes sobre HEADERS e outros detalhes mais que pretendo falar mais pra frente. A ideia principal aqui é ser coeso. Não colocar complexidades nas URLs e essas serem apenas recursos, não verbos. Utilizar ao máximo o que o HTTP tem para nos oferecer e documentar tudo que pudermos.</p>
<p>Uma boa documentação é uma excelente aliada. Outro ponto importante é sempre usar o plural nos recursos, faz mais sentido (basta ler para perceber) do que usar singulares. Não precisa usar IDs não URLs também. Podemos utilizar qualquer atributo único no lugar do ID, embora eu prefira os IDs.</p>
<p>É isso, pessoal. Espero ter deixado claro o funcionamento básico do REST. Qualquer dúvida, podem falar.</p>    </div>

    <nav class="flex justify-between text-sm md:text-base">
        <div>
                            <a href="https://tonysm.github.io/blog/2014-03-06-desenvolvendo-uma-api-parte-1" title="Older Post: Desenvolvendo uma API - parte 1">
                    &LeftArrow; Desenvolvendo uma API - parte 1
                </a>
                    </div>

        <div>
                            <a href="https://tonysm.github.io/blog/2014-09-23-command-oriented-architecture" title="Newer Post: Command-Oriented Architecture">
                    Command-Oriented Architecture &RightArrow;
                </a>
                    </div>
    </nav>
        </main>

        <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center list-reset">
                <li>
                    Built with <a href="http://jigsaw.tighten.co" title="Jigsaw by Tighten">Jigsaw</a>
                    and <a href="https://tailwindcss.com" title="Tailwind CSS, a utility-first CSS framework">Tailwind CSS</a>.
                </li>
            </ul>
        </footer>

        <script src="/assets/build/js/main.js?id=8e859a7d8db413dd71b1"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>
    </body>
</html>
